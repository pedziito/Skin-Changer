name: Build CS2 Inventory Changer

on:
  push:
    branches: [ main ]
    tags: [ 'v*' ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Install dependencies
      run: choco install cmake -y

    - name: Setup MSVC
      uses: ilammy/msvc-dev-cmd@v1

    - name: Create build directory
      run: mkdir build

    - name: Configure CMake
      run: |
        cd build
        cmake .. -G "Visual Studio 17 2022" -A x64 -DCMAKE_BUILD_TYPE=Release

    - name: Build project
      run: |
        cd build
        cmake --build . --config Release --verbose

    - name: Upload cs2inventory.exe to Release
      if: startsWith(github.ref, 'refs/tags/')
      uses: softprops/action-gh-release@v1
      with:
        files: build/bin/cs2inventory.exe
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    - name: Upload artifact (for debugging)
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: cs2inventory-exe
        path: build/bin/cs2inventory.exe

        retention-days: 30

    - name: Create Release
      if: startsWith(github.ref, 'refs/tags/')
      uses: actions/create-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        tag_name: ${{ github.ref }}
        release_name: CS2 Inventory Changer ${{ github.ref }}
        body: |
          CS2 Inventory Changer Release
          
          Single-File Executable:
          - cs2inventory.exe: Complete application (all components built-in)
          - cs2admin.exe: License management tool
          
          Installation:
          1. Place cs2inventory.exe anywhere
          2. Obtain license.key from admin
          3. Run cs2inventory.exe
          4. Login with your account
          5. Start CS2 game
          6. Press INS to open menu
          
          This version includes everything needed in a single executable.

